<!-- receive.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Đang chuyển hướng...</title>
</head>
<body>
  <p id="status">Đang tải tin nhắn...</p>

  <script type="module">
 const firebaseConfig = { 
  apiKey : "AIzaSyB9elXt44pt-DGYygIOWQog8XE-YqQO_I8" , 
  authDomain : "email-sync-tool.firebaseapp.com" , 
  databaseURL : "https://email-sync-tool-default-rtdb.asia-southeast1.firebasedatabase.app" , 
  projectId : "email-sync-tool" , 
  storageBucket : "email-sync-tool.firebasestorage.app" , 
  messagingSenderId : "902586987378" , 
  appId : "1:902586987378:web:b151f5d50773490816e3eb" 
};



    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById("status");
    const latestDoc = doc(db, "messages", "latest");

    function isValidUrl(text) {
      try { return new URL(text); } catch (e) { return null; }
    }

    onSnapshot(latestDoc, (snap) => {
      if (snap.exists()) {
        const data = snap.data();
        const text = data.message || "";
        const url = isValidUrl(text);

        if (url) {
          statusEl.textContent = "Đang chuyển hướng tới " + url.href + "...";
          window.location.href = url.href; // Tự động redirect
        } else {
          statusEl.textContent = "Nội dung không phải đường link: " + text;
        }
      } else {
        statusEl.textContent = "Chưa có tin nhắn nào.";
      }
    });
  </script>
</body>
</html>
