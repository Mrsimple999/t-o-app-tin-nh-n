

<!-- receive.html -->
<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nh·∫≠n tin nh·∫Øn - Web c·ªë ƒë·ªãnh</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:24px;background:#f7fafc}
  .card{max-width:720px;margin:12px auto;padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.06);background:#fff}
  .muted{color:#6b7280;font-size:13px}
  #savedMessage{white-space:pre-wrap;margin-top:8px;padding:10px;border-radius:8px;background:#fff;border:1px solid #eef2f7;min-height:44px}
  #autoCopyMsg{margin-top:8px;color:green;display:none}
  #toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#2563eb;color:#fff;padding:10px 18px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:none;z-index:9999;}
</style>
</head>
<body>
<div class="card">
  <h2>Tin nh·∫Øn m·ªõi nh·∫•t</h2>
  <div id="savedMessage">ƒêang t·∫£i...</div>
  <div class="muted">ƒê√£ t·∫°o: <span id="createdAt">‚Äî</span></div>
  <div id="autoCopyMsg">‚úî N·ªôi dung ƒë√£ ƒë∆∞·ª£c sao ch√©p v√†o b·ªô nh·ªõ t·∫°m</div>
</div>
<div id="toast"></div>
<script type="module">
const firebaseConfig = { 
  apiKey : "AIzaSyB9elXt44pt-DGYygIOWQog8XE-YqQO_I8" , 
  authDomain : "email-sync-tool.firebaseapp.com" , 
  databaseURL : "https://email-sync-tool-default-rtdb.asia-southeast1.firebasedatabase.app" , 
  projectId : "email-sync-tool" , 
  storageBucket : "email-sync-tool.firebasestorage.app" , 
  messagingSenderId : "902586987378" , 
  appId : "1:902586987378:web:b151f5d50773490816e3eb" 
};


  

import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
import { getFirestore, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const savedMessage = document.getElementById('savedMessage');
const createdAtEl = document.getElementById('createdAt');
const autoCopyMsg = document.getElementById('autoCopyMsg');
const toast = document.getElementById('toast');
let lastMessage = '';

function showToast(msg){
  toast.textContent = msg;
  toast.style.display='block';
  setTimeout(()=>{ toast.style.display='none'; },3000);
}

function createClickableLink(text){
  // N·∫øu l√† URL, t·∫°o link
  const urlRegex = /(https?:\/\/[^\s]+)/g;
  return text.replace(urlRegex, '<a href="$1" target="_blank">$1</a>');
}

const latestDoc = doc(db,'messages','latest');

onSnapshot(latestDoc, async (snap)=>{
  if(snap.exists()){
    const data = snap.data();
    savedMessage.innerHTML = createClickableLink(data.message || '');
    if(data.createdAt && data.createdAt.toDate){
      createdAtEl.textContent = data.createdAt.toDate().toLocaleString();
    }
    // Auto-copy
    try{ await navigator.clipboard.writeText(data.message||''); autoCopyMsg.style.display='block'; }
    catch(e){ console.warn('Kh√¥ng th·ªÉ auto copy',e); }

    // Popup toast khi tin nh·∫Øn m·ªõi
    if(data.message && data.message !== lastMessage){
      lastMessage = data.message;
      showToast('üì© Tin nh·∫Øn m·ªõi: ' + data.message);

      // Notification n·∫øu ƒë∆∞·ª£c ph√©p
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('Tin nh·∫Øn m·ªõi', { body: data.message });
      } else if('Notification' in window && Notification.permission !== 'denied'){
        Notification.requestPermission();
      }
    }
  } else {
    savedMessage.textContent = 'Ch∆∞a c√≥ tin nh·∫Øn';
    createdAtEl.textContent = '‚Äî';
  }
});
</script>
</body>
</html>
